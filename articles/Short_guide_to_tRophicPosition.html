<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Short guide to the use of tRophicPosition • tRophicPosition</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Short guide to the use of tRophicPosition">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tRophicPosition</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Multiple_model_calculation_of_trophic_position_in_R.html">Using tRophicPosition to estimate TP through the use of multiple models</a></li>
    <li><a class="dropdown-item" href="../articles/Multiple_species_calculation_of_trophic_position_in_R_1.html">tRophicPosition: calculating trophic position for multiple species</a></li>
    <li><a class="dropdown-item" href="../articles/Short_guide_to_tRophicPosition.html">Short guide to the use of tRophicPosition</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/clquezada/tRophicPosition/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Short guide to the use of tRophicPosition</h1>
                        <h4 data-toc-skip class="author">Claudio
Quezada-Romegialli, Andrew L Jackson &amp; Chris Harrod</h4>
            
            <h4 data-toc-skip class="date">December 11 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/clquezada/tRophicPosition/blob/master/vignettes/Short_guide_to_tRophicPosition.Rmd" class="external-link"><code>vignettes/Short_guide_to_tRophicPosition.Rmd</code></a></small>
      <div class="d-none name"><code>Short_guide_to_tRophicPosition.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="trophicposition">tRophicPosition<a class="anchor" aria-label="anchor" href="#trophicposition"></a>
</h2>
<p><code>tRophicPosition</code>, is an R package incorporating a
Bayesian model for the calculation of consumer trophic position using
stable isotopes with one or two baselines. As of 2022-12-11, the current
version of the package is 0.8. <code>tRophicPosition</code> uses the
powerful approach of Markov Chain Monte Carlo simulations provided by <a href="https://mcmc-jags.sourceforge.io/" class="external-link">JAGS</a> and the statistical
language <a href="https://www.r-project.org" class="external-link">R</a>. Vignettes can be
browsed with <code>browseVignettes("tRophicPosition")</code>.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we provide a short guide to the use of
<code>tRophicPosition</code> in its current version (0.8).</p>
<div class="section level3">
<h3 id="installing-and-loading-the-package">Installing and loading the package<a class="anchor" aria-label="anchor" href="#installing-and-loading-the-package"></a>
</h3>
<div class="section level4">
<h4 id="stable-version---cran">Stable version - CRAN<a class="anchor" aria-label="anchor" href="#stable-version---cran"></a>
</h4>
<p>First of all, you need to install <a href="https://mcmc-jags.sourceforge.io/" class="external-link">JAGS</a> for your platform, and
then install the stable version of <code>tRophicPosition</code> from <a href="https://CRAN.R-project.org/package=tRophicPosition" class="external-link">CRAN</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tRophicPosition"</span><span class="op">)</span></span></code></pre></div>
<p>After that, you have to load the package with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/clquezada/tRophicPosition" class="external-link">tRophicPosition</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="development-version---github">Development version - GitHub<a class="anchor" aria-label="anchor" href="#development-version---github"></a>
</h4>
<p>If you want to install the development version of
<code>tRophicPosition</code>, you must install it from GitHub. For this,
we use the function <code>install_github()</code> from the package
<code>devtools</code> (installation instructions <a href="https://github.com/r-lib/devtools#updating-to-the-latest-version-of-devtools" class="external-link">here</a>),
which needs to be installed previously (either from <a href="https://CRAN.R-project.org/package=devtools" class="external-link">CRAN</a> or <a href="https://github.com/r-lib/devtools" class="external-link">GitHub</a>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span></code></pre></div>
<p>If you are working in Windows, <code>devtools</code> also requires <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a>, or if
you are working on a Mac, <a href="https://developer.apple.com/xcode/" class="external-link">Xcode</a> (from Apple Store).
In Linux you will need to install a compiler and various development
libraries.</p>
<p>Besides installing <code>devtools</code>, you must also install <a href="https://mcmc-jags.sourceforge.io/" class="external-link">JAGS</a> (Just Another Gibbs
Sampler), which is at the core of the Bayesian model analysis supporting
<code>tRophicPosition</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install_github</span><span class="op">(</span><span class="st">"clquezada/tRophicPosition"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>After installing <code>tRophicPosition</code>, it should be loaded
into memory, which automatically reports the version of the software (we
need at least 0.6.8-8 to use the routines described in this
vignette).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/clquezada/tRophicPosition" class="external-link">tRophicPosition</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is tRophicPosition 0.8.0</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="future-releases-and-how-to-get-support">Future releases and how to get support<a class="anchor" aria-label="anchor" href="#future-releases-and-how-to-get-support"></a>
</h3>
<p>You are encouraged to use <code>tRophicPosition</code> with your own
data, test the package and see if there are any issues or problems. You
can send your questions or commentaries to the google group <a href="https://groups.google.com/d/forum/trophicposition-support" class="external-link">tRophicPosition-support</a>
or directly to the email <a href="mailto:trophicposition-support@googlegroups.com" class="email">trophicposition-support@googlegroups.com</a>. You can send
your questions to <a href="https://stackexchange.com/" class="external-link uri">https://stackexchange.com/</a> <a href="https://stackoverflow.com/" class="external-link uri">https://stackoverflow.com/</a> or even <a href="https://www.facebook.com/groups/stableisotopes/" class="external-link">Facebook (stable
isotope ecology group)</a>.</p>
<p>We are constantly working on future releases of
<code>tRophicPosition</code>, so feedback is very much appreciated.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-trophicposition">Working with tRophicPosition<a class="anchor" aria-label="anchor" href="#working-with-trophicposition"></a>
</h2>
<div class="section level3">
<h3 id="loading-data-into-r">Loading data into R<a class="anchor" aria-label="anchor" href="#loading-data-into-r"></a>
</h3>
<p>To use <code>tRophicPosition</code>, you need to load data into R.
You can use any function you prefer (e.g. <code>read.csv</code>,
<code>read.table</code>, etc.) to accomplish this. For convenience, we
have included a csv file within the package and we will load it with
<code>read.csv</code>. The dataset <code>Bilagay-MEC.csv</code> includes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>13</mn></msup><annotation encoding="application/x-tex">\delta^{13}</annotation></semantics></math>C
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
stable isotope data for one locality for the bilagay <em>Cheilodactylus
variegatus</em> (<a href="http://www.fishbase.se/summary/Cheilodactylus-variegatus.html" class="external-link uri">http://www.fishbase.se/summary/Cheilodactylus-variegatus.html</a>),
a fish common to the coastal kelp forests of N Chile. It also includes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>13</mn></msup><annotation encoding="application/x-tex">\delta^{13}</annotation></semantics></math>C
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
for two groups of primary consumers: one that provides a long-term
integrated indicator of the pelagic baseline (filter feeding bivalves)
and another for the benthic baseline (grazing gastropods), following
Post (2002).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BilagayMEC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Bilagay-MEC.csv"</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">"tRophicPosition"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In this case we have indicated a <code>system.file</code> function to
locate the file within the package. After loading the file, we need to
extract the stable isotope data and convert it to a format recognized by
the package. If you want to use the package with your own data, you will
need to use a data frame that has a similar structure:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">BilagayMEC</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Study Location                       Spp         FG  d13C d15N NS</span></span>
<span><span class="co">## 1   MEC Coquimbo Echinolittorina peruviana Benthic_BL -11.1 14.9  1</span></span>
<span><span class="co">## 2   MEC Coquimbo Echinolittorina peruviana Benthic_BL -11.9 15.2  1</span></span>
<span><span class="co">## 3   MEC Coquimbo Echinolittorina peruviana Benthic_BL -11.7 15.0  1</span></span>
<span><span class="co">## 4   MEC Coquimbo Echinolittorina peruviana Benthic_BL -11.5 15.2  1</span></span>
<span><span class="co">## 5   MEC Coquimbo         Prisogaster niger Benthic_BL -14.6 16.3  1</span></span>
<span><span class="co">## 6   MEC Coquimbo         Prisogaster niger Benthic_BL -13.8 15.7  1</span></span></code></pre>
<p>Here FG stands for functional group, and NS refers to an integer
representing the north to south ordering of locations. To extract the
stable isotope data from the data frame above we will use a function we
have provided in the package called <code><a href="../reference/loadIsotopeData.html">loadIsotopeData()</a></code>. By
default, this function extracts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>13</mn></msup><annotation encoding="application/x-tex">\delta^{13}</annotation></semantics></math>C
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
stable isotope values from the columns <code>d13C</code> and
<code>d15N</code>, grouping observations by a consumer, one or two
baselines and a group identifier (here community, but can be location,
time etc):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consumer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadIsotopeData.html">loadIsotopeData</a></span><span class="op">(</span><span class="va">BilagayMEC</span>, consumer <span class="op">=</span> <span class="st">"Bilagay"</span>, consumersColumn <span class="op">=</span> <span class="st">"FG"</span>,</span>
<span>                            b1 <span class="op">=</span> <span class="st">"Pelagic_BL"</span>, b2 <span class="op">=</span> <span class="st">"Benthic_BL"</span>,</span>
<span>                            baselineColumn <span class="op">=</span> <span class="st">"FG"</span>,</span>
<span>                            group <span class="op">=</span> <span class="st">"Coquimbo"</span>, groupsColumn <span class="op">=</span> <span class="st">"Location"</span><span class="op">)</span></span></code></pre></div>
<p>In the case above we have indicated that all observations that
coincide with “Pelagic_BL” in the column “FG” will be extracted as
baseline1, and all observations that coincide with “Benthic_BL” in the
same column will be extracted as baseline2. And also, all observations
that coincide with “Bilagay” in the column “FG” and coincide with
“Coquimbo” in the column “location” will be extracted as consumer
values. Other options are available, and they can be found with
<code><a href="../reference/loadIsotopeData.html">help(loadIsotopeData)</a></code>.</p>
<p>An essential component of the model to estimate trophic position is
the trophic discrimination factor (TDF). By default the function
<code><a href="../reference/loadIsotopeData.html">loadIsotopeData()</a></code> returns
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>N
(3.4
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
0.98 sd) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>C
(0.39
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
1.3 sd) based on Post’s (2002) assumptions. But you can change this
assumption to use any values, simply adding them as arguments within the
call to this function. For example, to get McCutchan’s et al (2003)
values on TDF, instead of Post’s (2002) assumptions we could write the
following:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we get TDF values from the internal database using McCutchan's et al</span></span>
<span><span class="co"># (2003) paper</span></span>
<span><span class="va">TDF_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TDF.html">TDF</a></span><span class="op">(</span>author <span class="op">=</span> <span class="st">"McCutchan"</span>, element <span class="op">=</span> <span class="st">"both"</span>, type <span class="op">=</span> <span class="st">"muscle"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You selected McCutchan's et al (2003)</span></span>
<span><span class="co">##                   Muscle tissue d15N: 15 values with mean 2.9 +- 0.32 se</span></span></code></pre>
<pre><code><span><span class="co">## Muscle tissue d13C: 18 values with mean 1.3 +- 0.3 se</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Then we use those values within the call to loadIsotopeData()</span></span>
<span><span class="va">consumer_with_McCutchan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadIsotopeData.html">loadIsotopeData</a></span><span class="op">(</span><span class="va">BilagayMEC</span>, </span>
<span>                                           consumer <span class="op">=</span> <span class="st">"Bilagay"</span>,</span>
<span>                                           b1 <span class="op">=</span> <span class="st">"Pelagic_BL"</span>,</span>
<span>                                           b2 <span class="op">=</span> <span class="st">"Benthic_BL"</span>, </span>
<span>                                           group <span class="op">=</span> <span class="st">"Coquimbo"</span>,</span>
<span>                                           consumersColumn <span class="op">=</span> <span class="st">"FG"</span>,</span>
<span>                                           baselineColumn <span class="op">=</span> <span class="st">"FG"</span>,</span>
<span>                                           groupsColumn <span class="op">=</span> <span class="st">"Location"</span>,</span>
<span>                                           deltaN <span class="op">=</span> <span class="va">TDF_values</span><span class="op">$</span><span class="va">deltaN</span>,</span>
<span>                                           deltaC <span class="op">=</span> <span class="va">TDF_values</span><span class="op">$</span><span class="va">deltaC</span><span class="op">)</span></span></code></pre></div>
<p>Instead of using mean values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
sd, one possibility of including the uncertainty of TDF is using the raw
data. So you can use a list of values given your knowledge of your
consumer or a colleague’s information,
e.g. <code>deltaN = c(2, 2.1, 1.9, 2.01, 2.2)</code> and/or
<code>deltaC = c(0.3, 0.31, 0.4, 0.32)</code>.</p>
<p>##Plot the data</p>
<p>At this point we have a <code>consumer</code> object (stable isotope
values of bilagay), pelagic and benthic baselines (in this case,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>13</mn></msup><annotation encoding="application/x-tex">\delta^{13}</annotation></semantics></math>C
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
values of filter feeding [pelagic indicator] and grazing [benthic
indicator] primary consumer molluscs) plus TDF assumptions based on Post
(2002). We have to plot the data to check that everything is fine:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we explicitly include a label for both baseline 1 and baseline 2.</span></span>
<span><span class="co"># We could change the label for the consumer (consumer = "new_label"), or even </span></span>
<span><span class="co"># change the position of the legend (legend = c(1.15, 1.15) is the default).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">consumer</span>, b1 <span class="op">=</span> <span class="st">"Pelagic baseline"</span>, b2 <span class="op">=</span> <span class="st">"Benthic baseline"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Short_guide_to_tRophicPosition_files/figure-html/unnamed-chunk-11-1.png" width="624"></p>
<p>Here we see that the data for our fish <em>bilagay</em> lay between
both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>13</mn></msup><annotation encoding="application/x-tex">\delta^{13}</annotation></semantics></math>C
baselines, and are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>15</mn></msup><annotation encoding="application/x-tex">^{15}</annotation></semantics></math>N-enriched
relative to the baselines (which also apparently differ in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
values).</p>
<p>We have several options for estimating bilagay trophic position. We
can calculate a single baseline Bayesian trophic position model which
only includes a TDF for nitrogen, or we can include both baselines
(which seeing they have different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>δ</mi><mn>15</mn></msup><annotation encoding="application/x-tex">\delta^{15}</annotation></semantics></math>N
values, seems reasonable), and we can include fractionation for both
nitrogen and carbon. This is what we will do – first estimate TP using a
single baseline, and then we will calculate the full model, including
both baselines and a TDF for both nitrogen and carbon.</p>
</div>
<div class="section level3">
<h3 id="the-bayesian-model">The Bayesian Model<a class="anchor" aria-label="anchor" href="#the-bayesian-model"></a>
</h3>
<p>We have coded three Bayesian models into tRophicPosition: one
baseline (<code><a href="../reference/jagsOneBaseline.html">jagsOneBaseline()</a></code>), two baselines, without TDF
for carbon (<code><a href="../reference/jagsTwoBaselines.html">jagsTwoBaselines()</a></code>) and two baseline full
model, that includes a TDF for carbon
(<code><a href="../reference/jagsTwoBaselinesFull.html">jagsTwoBaselinesFull()</a></code>). The model can be defined using
either of the functions mentioned, or using the new function
<code><a href="../reference/jagsBayesianModel.html">jagsBayesianModel()</a></code>, first introduced in the release 0.6.8
of <code>tRophicPosition</code>.</p>
<p>To make full use of the Bayesian approach coded in
<code>tRophicPosition</code>, the user can change the priors for any of
the parameters of the different models, or the constants (e.g. lambda).
Here we will define an one baseline model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.string</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jagsBayesianModel.html">jagsBayesianModel</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"oneBaseline"</span>, TP <span class="op">=</span> <span class="st">"dnorm(4, 0.1)"</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/jagsBayesianModel.html">jagsBayesianModel()</a></code> receives as arguments
the <code>model</code> variable (with three options: “oneBaseline”,
“twoBaselines” or “twoBaselinesFull”), and optionally receives any
distribution for the parameters. If no argument is received, then by
default this function returns the two baselines full model. In the
example above we have defined also a normal distribution with a mean of
4 and SD of 0.1 as priors for the parameter TP, which is trophic
position. Here we are pretty confident (given the stomach contents) that
our fish has a TP = 4. All of the functions that define a Bayesian
model, by default return <code>lambda = 2</code> to indicate the trophic
level of the baseline, which in this case is the bivalve <em>Perumytilus
purpuratus</em> (pelagic baseline). If you want to change it, simply add
this argument within the call to <code><a href="../reference/jagsBayesianModel.html">jagsBayesianModel()</a></code> or any
of the other functions.</p>
<p>The next step is to initialize the model, using the function
<code><a href="../reference/TPmodel.html">TPmodel()</a></code>. The only two arguments needed are
<code>data</code> and <code>model.string</code>, where the first is the
stable isotope data and the second is the Bayesian model we just defined
above. The other arguments are optional.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TPmodel.html">TPmodel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">consumer</span>, model.string <span class="op">=</span> <span class="va">model.string</span>,</span>
<span>                 n.adapt <span class="op">=</span> <span class="fl">20000</span>, n.chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in rjags::jags.model(con, data = data, n.chains = n.chains, n.adapt =</span></span>
<span><span class="co">## n.adapt, : Unused variable "dCb1" in data</span></span></code></pre>
<pre><code><span><span class="co">## Warning in rjags::jags.model(con, data = data, n.chains = n.chains, n.adapt =</span></span>
<span><span class="co">## n.adapt, : Unused variable "dNb2" in data</span></span></code></pre>
<pre><code><span><span class="co">## Warning in rjags::jags.model(con, data = data, n.chains = n.chains, n.adapt =</span></span>
<span><span class="co">## n.adapt, : Unused variable "dCb2" in data</span></span></code></pre>
<pre><code><span><span class="co">## Warning in rjags::jags.model(con, data = data, n.chains = n.chains, n.adapt =</span></span>
<span><span class="co">## n.adapt, : Unused variable "deltaC" in data</span></span></code></pre>
<pre><code><span><span class="co">## Warning in rjags::jags.model(con, data = data, n.chains = n.chains, n.adapt =</span></span>
<span><span class="co">## n.adapt, : Unused variable "dCc" in data</span></span></code></pre>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 81</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 16</span></span>
<span><span class="co">##    Total graph size: 110</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<p>The initializating phase is needed because samplers adapt their
parameters to maximize their efficiency. After the initialization it
takes place the actual Markov Chain Monte Carlo sampling, which is done
with the function <code><a href="../reference/posteriorTP.html">posteriorTP()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior.samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posteriorTP.html">posteriorTP</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>, n.iter <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>                                 variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TP"</span>, <span class="st">"muDeltaN"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the example above we set 20,000 MCMC iterations to sample the
posterior using the model defined with <code><a href="../reference/TPmodel.html">TPmodel()</a></code>. Also we
defined to monitor the variables <code>"TP"</code> and
<code>"muDeltaN"</code> (which is the default). TP is trophic position,
our main parameter of interest, but also we included muDeltaN which is
the mean for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>N.</p>
</div>
<div class="section level3">
<h3 id="analyzing-and-plotting-the-posterior-estimation-of-trophic-position">Analyzing and plotting the posterior estimation of trophic
position<a class="anchor" aria-label="anchor" href="#analyzing-and-plotting-the-posterior-estimation-of-trophic-position"></a>
</h3>
<p>If everything went well, then we have calculated trophic position
with Bayesian inference. The function <code><a href="../reference/posteriorTP.html">posteriorTP()</a></code> returns
an object of the class “mcmc.list”, so we can use the generic method
summary from the coda package:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">posterior.samples</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Iterations = 20010:40000</span></span>
<span><span class="co">## Thinning interval = 10 </span></span>
<span><span class="co">## Number of chains = 2 </span></span>
<span><span class="co">## Sample size per chain = 2000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">##    plus standard error of the mean:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           Mean     SD Naive SE Time-series SE</span></span>
<span><span class="co">## TP       3.720 0.1108 0.001751       0.001826</span></span>
<span><span class="co">## muDeltaN 3.393 0.1343 0.002123       0.002085</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 2. Quantiles for each variable:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           2.5%   25%   50%   75% 97.5%</span></span>
<span><span class="co">## TP       3.505 3.647 3.718 3.789 3.946</span></span>
<span><span class="co">## muDeltaN 3.124 3.306 3.394 3.481 3.661</span></span></code></pre>
<p>The coda package provided useful summary statistics, but some
researchers feel that best practice when describing central tendency of
posterior distributions is to use the mode. We will use the function
<code><a href="../reference/getPosteriorMode.html">getPosteriorMode()</a></code> to estimate this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we combine both chains (if we sample them)</span></span>
<span><span class="va">posterior.combined</span> <span class="op">&lt;-</span> <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">posterior.samples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then we calculate the mode with this code</span></span>
<span><span class="fu"><a href="../reference/getPosteriorMode.html">getPosteriorMode</a></span><span class="op">(</span><span class="va">posterior.combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       TP muDeltaN </span></span>
<span><span class="co">##     3.68     3.44</span></span></code></pre>
<p>In order to graphically depict our results we can use the generic
plot function from coda package (<code>plot(posterior.samples)</code>),
or even use other R packages to process/display the information in the
posterior samples, such as <code>MCMCtrace()</code> and
<code>MCMCplot()</code> functions from the package MCMCvis.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">posterior.samples</span><span class="op">)</span></span></code></pre></div>
<p><img src="Short_guide_to_tRophicPosition_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>The plot above (<code>plot(posterior.samples)</code>) visualizes the
trace and density of MCMC chains for our parameters of interest, in this
case TP (trophic position) and muDeltaN (mean of TDF for nitrogen). It
gives us a quick way to visualize if posterior sampling has converged:
there should be no tendency of increase or decrease over time (both
chains in trace plot are well mixed) and the density for both parameters
should be smooth and unimodal (given the assumptions of the one baseline
Bayesian model in this particular case).</p>
<p>The plot below (<code><a href="../reference/plotTP.html">plotTP()</a></code>, a wrapper from <a href="https://github.com/AndrewLJackson/SIBER/blob/master/R/siberdensityplot.R" class="external-link">SIBER</a>)
visualizes the posterior distributions of both TP and muDeltaN. It gives
a graphical summary of the mode and 95, 75 and 50 percent credible
intervals for each posterior distribution (see
<code>?SIBER::siberDensityPlot</code> for details).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we combine the 2 chains</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">posterior.samples</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then we plot the data using a wrapper of SIBER::siberDensityPlot()</span></span>
<span><span class="fu"><a href="../reference/plotTP.html">plotTP</a></span><span class="op">(</span><span class="va">combined</span>, xlab <span class="op">=</span> <span class="st">"Monitored variables"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Short_guide_to_tRophicPosition_files/figure-html/unnamed-chunk-20-1.png" width="480"></p>
<p>When we are dealing with more than one species, or more than one
Bayesian model (for one species) we will use the function
<code><a href="../reference/credibilityIntervals.html">credibilityIntervals()</a></code>. This is covered in the rest of
vignettes.</p>
</div>
</div>
<div class="section level2">
<h2 id="further-use-of-trophicposition">Further use of tRophicPosition<a class="anchor" aria-label="anchor" href="#further-use-of-trophicposition"></a>
</h2>
<p>Our aim in building this package was to make it as useful as
possible. As such, we have coded a number of more complex (but
informative) functions for users who want to take full advantage of
<code>tRophicPosition</code>. These functions includes multiple models
that compare different means of calculating TP
(<code><a href="../reference/multiModelTP.html">multiModelTP()</a></code>), automatic comparisons between multiple
species e.g. for community based comparisons, or comparisons for single
species across multiple locations (<code><a href="../reference/multiSpeciesTP.html">multiSpeciesTP()</a></code>),
pairwise comparison between two (<code><a href="../reference/compareTwoDistributions.html">compareTwoDistributions()</a></code>)
or multiple posterior estimations (<code><a href="../reference/pairwiseComparisons.html">pairwiseComparisons()</a></code>),
non-Bayesian version of trophic position (<code><a href="../reference/parametricTP.html">parametricTP()</a></code>),
parsing multiple species or communities from a data frame
(<code><a href="../reference/loadIsotopeData.html">loadIsotopeData()</a></code> and <code><a href="../reference/extractIsotopeData.html">extractIsotopeData()</a></code>),
or screening food webs for more than one species
(<code><a href="../reference/screenFoodWeb.html">screenFoodWeb()</a></code>). These functions are described in a
number of other vignettes included within the package. To access them
with, simply use the following code:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/browseVignettes.html" class="external-link">browseVignettes</a></span><span class="op">(</span><span class="st">"tRophicPosition"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claudio Quezada-Romegialli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
